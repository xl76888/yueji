<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="never">
    <base href="./">
    <title>莹磊悦行 - 行程详情</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 基础样式 */
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* 头部样式 */
        .header {
            position: relative;
            overflow: hidden;
            background: linear-gradient(45deg, #1a237e, #e65100);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .header h1 {
            color: white;
            margin: 0;
            font-size: 28px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .back-button {
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 20px;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* 导航菜单样式 */
        .header-nav {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .header-nav a {
            text-decoration: none;
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .header-nav a:hover, .header-nav a.active {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* 行程详情样式 */
        .plan-detail {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .plan-banner {
            background: linear-gradient(45deg, #1a237e, #e65100);
            color: white;
            padding: 30px;
            position: relative;
        }

        .plan-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .plan-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }

        .plan-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        .plan-description {
            font-size: 16px;
            margin-bottom: 15px;
            line-height: 1.6;
            max-width: 80%;
        }

        .plan-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            background: rgba(255,255,255,0.3);
        }

        .plan-content {
            padding: 30px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1a237e;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            background: linear-gradient(45deg, #1a237e, #e65100);
            color: white;
            font-size: 14px;
            padding: 8px;
            border-radius: 50%;
        }

        /* 目的地样式 */
        .destinations {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }

        .destination-item {
            background: #f5f5f5;
            padding: 10px 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .destination-type {
            font-size: 12px;
            background: rgba(26, 35, 126, 0.1);
            color: #1a237e;
            padding: 3px 8px;
            border-radius: 10px;
        }

        /* 行程安排样式 */
        .itinerary {
            margin-bottom: 30px;
        }

        .day-schedule {
            margin-bottom: 30px;
        }

        .day-header {
            background: rgba(26, 35, 126, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .day-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a237e;
        }

        .day-date {
            background: #1a237e;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
        }

        .schedule-list {
            margin-left: 20px;
            border-left: 2px dashed #e0e0e0;
            padding-left: 20px;
        }

        .schedule-item {
            position: relative;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #f0f0f0;
        }

        .schedule-item:last-child {
            border-bottom: none;
        }

        .schedule-item::before {
            content: '';
            position: absolute;
            left: -31px;
            top: 0;
            width: 20px;
            height: 20px;
            background: white;
            border: 2px solid #1a237e;
            border-radius: 50%;
        }

        .schedule-time {
            font-weight: 600;
            color: #1a237e;
            margin-bottom: 5px;
        }

        .schedule-activity {
            padding-left: 20px;
            position: relative;
        }

        /* 住宿信息样式 */
        .accommodation {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .accommodation-info {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .accommodation-item {
            display: flex;
            flex-direction: column;
        }

        .accommodation-label {
            font-size: 14px;
            color: #777;
            margin-bottom: 5px;
        }

        .accommodation-value {
            font-weight: 600;
        }

        /* 交通信息样式 */
        .transportation {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .transportation-info {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .transportation-item {
            display: flex;
            flex-direction: column;
        }

        .transportation-label {
            font-size: 14px;
            color: #777;
            margin-bottom: 5px;
        }

        .transportation-value {
            font-weight: 600;
        }

        /* 预算信息样式 */
        .budget {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .budget-chart {
            height: 200px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-end;
            gap: 15px;
            padding: 0 20px;
        }

        .budget-bar {
            flex: 1;
            background: linear-gradient(to top, #1a237e, #3949ab);
            border-radius: 5px 5px 0 0;
            position: relative;
            min-width: 40px;
            transition: all 0.3s ease;
        }

        .budget-bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            color: #777;
            white-space: nowrap;
        }

        .budget-bar-value {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
            color: #1a237e;
            font-weight: 600;
        }

        .budget-total {
            background: rgba(26, 35, 126, 0.1);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .budget-total-label {
            font-weight: 600;
            color: #1a237e;
        }

        .budget-total-value {
            font-size: 20px;
            font-weight: 700;
            color: #e65100;
        }

        /* 笔记样式 */
        .notes {
            background: #fffde7;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #ffc107;
        }

        .notes-content {
            font-style: italic;
            color: #795548;
        }

        /* 创建/修改信息样式 */
        .meta-info {
            font-size: 14px;
            color: #777;
            text-align: right;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
        }

        /* 操作按钮样式 */
        .plan-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .plan-action-btn {
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .plan-action-btn.edit {
            background: #1a237e;
            color: white;
        }

        .plan-action-btn.share {
            background: #4caf50;
            color: white;
        }

        .plan-action-btn.export {
            background: #ff9800;
            color: white;
        }

        .plan-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .header-nav {
                width: 100%;
                justify-content: center;
                margin-top: 15px;
            }
            
            .plan-banner {
                padding: 20px;
            }
            
            .plan-title {
                font-size: 22px;
            }
            
            .plan-status {
                position: static;
                display: inline-block;
                margin-top: 10px;
            }
            
            .plan-description {
                max-width: 100%;
            }
            
            .plan-content {
                padding: 20px;
            }
            
            .budget-chart {
                height: 150px;
            }
            
            .plan-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="plan-container">
        <div class="header">
            <h1><i class="fas fa-calendar-alt"></i> 行程规划</h1>
            <a href="plans.html" class="back-button">
                <i class="fas fa-arrow-left"></i> 返回行程列表
            </a>
            <!-- 导航菜单 -->
            <nav class="header-nav">
                <a href="index.html">首页</a>
                <a href="travel.html">旅游攻略</a>
                <a href="memories.html">旅行回忆</a>
                <a href="plans.html" class="active">行程规划</a>
                <a href="blog.html">旅行日志</a>
            </nav>
        </div>

        <!-- 行程详情内容区域 - 将由JavaScript填充 -->
        <div id="plan-detail-content"></div>
    </div>

    <script src="js/data-loader.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // 获取URL参数中的行程ID
                const urlParams = new URLSearchParams(window.location.search);
                const planId = parseInt(urlParams.get('id'));
                
                if (!planId) {
                    throw new Error('缺少行程ID参数');
                }
                
                // 初始化数据加载器
                await dataLoader.init();
                
                // 获取行程详情
                const plan = dataLoader.getPlanById(planId);
                
                if (!plan) {
                    throw new Error('找不到指定ID的行程');
                }
                
                // 更新页面标题
                document.title = `${plan.title} - 莹磊悦行`;
                
                // 渲染行程详情
                renderPlanDetail(plan);
                
            } catch (error) {
                console.error('行程加载失败:', error);
                document.getElementById('plan-detail-content').innerHTML = `
                    <div style="background: white; padding: 30px; border-radius: 15px; text-align: center;">
                        <h2>行程加载失败</h2>
                        <p>${error.message || '请刷新页面重试'}</p>
                        <a href="plans.html" style="display: inline-block; margin-top: 20px; background: #1a237e; color: white; padding: 10px 20px; border-radius: 20px; text-decoration: none;">返回行程列表</a>
                    </div>
                `;
            }
        });
        
        // 渲染行程详情
        function renderPlanDetail(plan) {
            const contentContainer = document.getElementById('plan-detail-content');
            
            // 计算天数
            const startDate = new Date(plan.startDate);
            const endDate = new Date(plan.endDate);
            const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            
            // 设置状态标签颜色
            const statusColors = {
                'confirmed': '#4caf50', // 绿色
                'draft': '#ff9800',      // 橙色
                'pending': '#2196f3'     // 蓝色
            };
            
            const statusText = {
                'confirmed': '已确认',
                'draft': '草稿',
                'pending': '待定'
            };
            
            let html = `
                <div class="plan-detail">
                    <div class="plan-banner">
                        <div class="plan-title">${plan.title}</div>
                        <div class="plan-info">
                            <div class="plan-info-item">
                                <i class="far fa-calendar-alt"></i>
                                <span>${plan.startDate} ~ ${plan.endDate}</span>
                            </div>
                            <div class="plan-info-item">
                                <i class="fas fa-clock"></i>
                                <span>${days}天</span>
                            </div>
                            <div class="plan-info-item">
                                <i class="fas fa-users"></i>
                                <span>
                                    ${plan.members.includes('xiaolei') ? '<i class="fas fa-male"></i> 小磊 ' : ''}
                                    ${plan.members.includes('xiaoying') ? '<i class="fas fa-female"></i> 小莹' : ''}
                                </span>
                            </div>
                        </div>
                        <div class="plan-description">${plan.description}</div>
                        <div class="plan-status" style="background-color: ${statusColors[plan.status]}">${statusText[plan.status]}</div>
                    </div>
                    
                    <div class="plan-content">
                        <!-- 目的地信息 -->
                        <div class="section-title">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>目的地</span>
                        </div>
                        <div class="destinations">
                            ${plan.destinations.map(dest => `
                                <div class="destination-item">
                                    <i class="${getDestinationIcon(dest.type)}"></i>
                                    <span>${dest.name}</span>
                                    <span class="destination-type">${getDestinationTypeName(dest.type)}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- 行程安排 -->
                        <div class="section-title">
                            <i class="fas fa-route"></i>
                            <span>行程安排</span>
                        </div>
                        <div class="itinerary">
                            ${plan.itinerary ? renderItinerary(plan.itinerary) : '<p>行程安排尚未完善，敬请期待。</p>'}
                        </div>
                        
                        <!-- 住宿信息 -->
                        ${plan.accommodation ? `
                            <div class="section-title">
                                <i class="fas fa-hotel"></i>
                                <span>住宿信息</span>
                            </div>
                            <div class="accommodation">
                                <div class="accommodation-info">
                                    <div class="accommodation-item">
                                        <div class="accommodation-label">酒店名称</div>
                                        <div class="accommodation-value">${plan.accommodation.name}</div>
                                    </div>
                                    <div class="accommodation-item">
                                        <div class="accommodation-label">联系电话</div>
                                        <div class="accommodation-value">${plan.accommodation.phone}</div>
                                    </div>
                                    <div class="accommodation-item">
                                        <div class="accommodation-label">房费/晚</div>
                                        <div class="accommodation-value">￥${plan.accommodation.price}</div>
                                    </div>
                                    <div class="accommodation-item accommodation-address" style="grid-column: 1/-1;">
                                        <div class="accommodation-label">地址</div>
                                        <div class="accommodation-value">${plan.accommodation.address}</div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- 交通信息 -->
                        ${plan.transportation ? `
                            <div class="section-title">
                                <i class="fas fa-car"></i>
                                <span>交通信息</span>
                            </div>
                            <div class="transportation">
                                <div class="transportation-info">
                                    <div class="transportation-item">
                                        <div class="transportation-label">交通方式</div>
                                        <div class="transportation-value">${plan.transportation.type}</div>
                                    </div>
                                    <div class="transportation-item">
                                        <div class="transportation-label">距离</div>
                                        <div class="transportation-value">${plan.transportation.distance}</div>
                                    </div>
                                    <div class="transportation-item">
                                        <div class="transportation-label">时间</div>
                                        <div class="transportation-value">${plan.transportation.duration}</div>
                                    </div>
                                    ${plan.transportation.notes ? `
                                        <div class="transportation-item" style="grid-column: 1/-1;">
                                            <div class="transportation-label">备注</div>
                                            <div class="transportation-value">${plan.transportation.notes}</div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- 预算信息 -->
                        ${plan.budget ? `
                            <div class="section-title">
                                <i class="fas fa-coins"></i>
                                <span>预算信息</span>
                            </div>
                            <div class="budget">
                                <div class="budget-chart">
                                    ${renderBudgetChart(plan.budget)}
                                </div>
                                <div class="budget-total">
                                    <div class="budget-total-label">总预算</div>
                                    <div class="budget-total-value">￥${plan.budget.total}</div>
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- 备注信息 -->
                        ${plan.notes ? `
                            <div class="section-title">
                                <i class="fas fa-sticky-note"></i>
                                <span>备注信息</span>
                            </div>
                            <div class="notes">
                                <div class="notes-content">${plan.notes}</div>
                            </div>
                        ` : ''}
                        
                        <!-- 操作按钮 -->
                        <div class="plan-actions">
                            <button class="plan-action-btn edit">
                                <i class="fas fa-edit"></i> 编辑行程
                            </button>
                            <button class="plan-action-btn share">
                                <i class="fas fa-share-alt"></i> 分享行程
                            </button>
                            <button class="plan-action-btn export">
                                <i class="fas fa-file-export"></i> 导出PDF
                            </button>
                        </div>
                        
                        <!-- 创建/更新信息 -->
                        <div class="meta-info">
                            <div>创建者：${plan.createdBy === 'xiaolei' ? '小磊' : '小莹'}</div>
                            <div>创建时间：${plan.createdAt}</div>
                            <div>最后更新：${plan.updatedAt}</div>
                        </div>
                    </div>
                </div>
            `;
            
            contentContainer.innerHTML = html;
            
            // 添加按钮点击事件
            const editButton = contentContainer.querySelector('.plan-action-btn.edit');
            editButton.addEventListener('click', function() {
                alert('行程编辑功能开发中，敬请期待！');
            });
            
            const shareButton = contentContainer.querySelector('.plan-action-btn.share');
            shareButton.addEventListener('click', function() {
                alert('行程分享功能开发中，敬请期待！');
            });
            
            const exportButton = contentContainer.querySelector('.plan-action-btn.export');
            exportButton.addEventListener('click', function() {
                alert('PDF导出功能开发中，敬请期待！');
            });
        }
        
        // 根据目的地类型获取图标
        function getDestinationIcon(type) {
            switch(type) {
                case 'scenic':
                    return 'fas fa-mountain';
                case 'cultural':
                    return 'fas fa-landmark';
                case 'historical':
                    return 'fas fa-history';
                case 'shopping':
                    return 'fas fa-shopping-bag';
                case 'entertainment':
                    return 'fas fa-ticket-alt';
                default:
                    return 'fas fa-map-pin';
            }
        }
        
        // 获取目的地类型名称
        function getDestinationTypeName(type) {
            switch(type) {
                case 'scenic':
                    return '自然风景';
                case 'cultural':
                    return '文化景点';
                case 'historical':
                    return '历史遗迹';
                case 'shopping':
                    return '购物场所';
                case 'entertainment':
                    return '娱乐场所';
                default:
                    return '其他';
            }
        }
        
        // 渲染行程安排
        function renderItinerary(itinerary) {
            if (!itinerary || itinerary.length === 0) {
                return '<p>行程安排尚未完善，敬请期待。</p>';
            }
            
            let html = '';
            
            itinerary.forEach(day => {
                html += `
                    <div class="day-schedule">
                        <div class="day-header">
                            <div class="day-title">第${day.day}天</div>
                            <div class="day-date">${day.date}</div>
                        </div>
                        <div class="schedule-list">
                            ${day.schedule.map(item => `
                                <div class="schedule-item">
                                    <div class="schedule-time">${item.time}</div>
                                    <div class="schedule-activity">${item.activity}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        // 渲染预算图表
        function renderBudgetChart(budget) {
            // 排除total属性
            const categories = Object.keys(budget).filter(key => key !== 'total');
            
            // 找出最大值，用于计算比例
            const maxValue = Math.max(...categories.map(key => budget[key]));
            
            let html = '';
            
            categories.forEach(category => {
                const value = budget[category];
                const height = (value / maxValue) * 100;
                
                html += `
                    <div class="budget-bar" style="height: ${height}%;">
                        <div class="budget-bar-value">￥${value}</div>
                        <div class="budget-bar-label">${getCategoryName(category)}</div>
                    </div>
                `;
            });
            
            return html;
        }
        
        // 获取预算类别名称
        function getCategoryName(category) {
            switch(category) {
                case 'accommodation':
                    return '住宿';
                case 'meals':
                    return '餐饮';
                case 'transportation':
                    return '交通';
                case 'activities':
                    return '活动';
                case 'shopping':
                    return '购物';
                default:
                    return category;
            }
        }
    </script>
</body>
</html> 